function toJalaali(b, c, a) { return d2j(g2d(b, c, a)) } function toGregorian(b, c, a) { return d2g(j2d(b, c, a)) } function isValidJalaaliDate(b, c, a) { return b >= -61 && b <= 3177 && c >= 1 && c <= 12 && a >= 1 && a <= jalaaliMonthLength(b, c) } function isLeapJalaaliYear(a) { return jalCal(a).leap === 0 } function jalaaliMonthLength(a, b) { if (b <= 6) { return 31 } if (b <= 11) { return 30 } if (isLeapJalaaliYear(a)) { return 30 } return 29 } function jalCal(l) { var k = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210, 1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178], e = k.length, m = l + 621, c = -14, f = k[0], h, o = 1, b, d, j; if (l < f || l >= k[e - 1]) { throw new Error("Invalid Jalaali year " + l) } for (j = 1; j < e; j += 1) { h = k[j]; o = h - f; if (l < h) { break } c = c + div(o, 33) * 8 + div(mod(o, 33), 4); f = h } d = l - f; c = c + div(d, 33) * 8 + div(mod(d, 33) + 3, 4); if (mod(o, 33) === 4 && o - d === 4) { c += 1 } var g = div(m, 4) - div((div(m, 100) + 1) * 3, 4) - 150; var a = 20 + c - g; if (o - d < 6) { d = d - o + div(o + 4, 33) * 33 } b = mod(mod(d + 1, 33) - 1, 4); if (b === -1) { b = 4 } return { leap: b, gy: m, march: a } } function j2d(b, c, a) { var d = jalCal(b); return g2d(d.gy, 3, d.march) + (c - 1) * 31 - div(c, 7) * (c - 7) + a - 1 } function d2j(g) { var h = d2g(g).gy, d = h - 621, f = jalCal(d), a = g2d(h, 3, f.march), b, e, c; c = g - a; if (c >= 0) { if (c <= 185) { e = 1 + div(c, 31); b = mod(c, 31) + 1; return { jy: d, jm: e, jd: b } } else { c -= 186 } } else { d -= 1; c += 179; if (f.leap === 1) { c += 1 } } e = 7 + div(c, 30); b = mod(c, 30) + 1; return { jy: d, jm: e, jd: b } } function g2d(b, c, a) { var e = div((b + div(c - 8, 6) + 100100) * 1461, 4) + div(153 * mod(c + 9, 12) + 2, 5) + a - 34840408; e = e - div(div(b + 100100 + div(c - 8, 6), 100) * 3, 4) + 752; return e } function d2g(d) { var a; a = 4 * d + 139361631; a = a + div(div(4 * d + 183187720, 146097) * 3, 4) * 4 - 3908; var b = div(mod(a, 1461), 4) * 5 + 308; var c = div(mod(b, 153), 5) + 1; var f = mod(div(b, 153), 12) + 1; var e = div(a, 1461) - 100100 + div(8 - f, 6); return { gy: e, gm: f, gd: c } } function div(d, c) { return ~~(d / c) } function mod(d, c) { return d - ~~(d / c) * c };